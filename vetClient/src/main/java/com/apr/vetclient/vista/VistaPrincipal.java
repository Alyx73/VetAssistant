/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.apr.vetclient.vista;

import com.apr.vetclient.modelo.dao.UsuarioDAO;
import com.apr.vetclient.modelo.vo.Usuario;
import com.apr.vetclient.util.Idioma;
import java.io.IOException;
import javax.swing.JOptionPane;

/**
 *
 * @author Alex
 */
public class VistaPrincipal extends javax.swing.JFrame {

    Usuario usuario;
    
    public VistaPrincipal(Usuario usuario) {
        initComponents();
        this.usuario = usuario;
        this.setLocationRelativeTo(null);
        String idioma = usuario.getIdioma();
        switch (idioma) {                   //Implemento un SWITCH para posibles ampliaciones a mas idiomas
            case "es-ES":
                mCastellano.setSelected(true);
                break;
            case "gl-ES":
                mGalego.setSelected(true);
                break;
            default:
                idioma = "es-ES";          //Valor por defecto castellano.
                mCastellano.setSelected(true);
        }
        // Cargo los textos del idioma seleccionado o guardado en las preferencias del usuario en la BD
        cargarTextos(idioma);
        // Activo o desactivo funciones segun ROL de usuario
        switch (usuario.getRol()) {    
            case "VETERINARIO":        //Dejo el swich aunque aquí son dos roles, me parece más visual
                iAdmin.setEnabled(false);
                mAdmin.setEnabled(false);
                iFacturas.setEnabled(false);
                mFacturas.setEnabled(false);       
                break;
            case "RECEPCIONISTA":
                iAdmin.setEnabled(false);
                mAdmin.setEnabled(false);
                break;
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        grupoRadioIdioma = new javax.swing.ButtonGroup();
        iMascotas = new javax.swing.JLabel();
        iFacturas = new javax.swing.JLabel();
        iCitas = new javax.swing.JLabel();
        iAdmin = new javax.swing.JLabel();
        jMenuBar1 = new javax.swing.JMenuBar();
        menuIr = new javax.swing.JMenu();
        mClientesMascotas = new javax.swing.JMenuItem();
        mCitas = new javax.swing.JMenuItem();
        mFacturas = new javax.swing.JMenuItem();
        mAdmin = new javax.swing.JMenuItem();
        menuIdioma = new javax.swing.JMenu();
        mCastellano = new javax.swing.JRadioButtonMenuItem();
        mGalego = new javax.swing.JRadioButtonMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        iMascotas.setIcon(new javax.swing.ImageIcon("C:\\Users\\Portégé\\Documents\\DAM\\PROYECTO\\Proyecto\\iloveimg-resized\\cliente y mascota.jpg")); // NOI18N
        iMascotas.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        iMascotas.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                iMascotasMouseClicked(evt);
            }
        });

        iFacturas.setIcon(new javax.swing.ImageIcon("C:\\Users\\Portégé\\Documents\\DAM\\PROYECTO\\Proyecto\\iloveimg-resized\\facturando.jpg")); // NOI18N
        iFacturas.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        iFacturas.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                iFacturasMouseClicked(evt);
            }
        });

        iCitas.setIcon(new javax.swing.ImageIcon("C:\\Users\\Portégé\\Documents\\DAM\\PROYECTO\\Proyecto\\iloveimg-resized\\citas.jpg")); // NOI18N
        iCitas.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        iCitas.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                iCitasMouseClicked(evt);
            }
        });

        iAdmin.setIcon(new javax.swing.ImageIcon("C:\\Users\\Portégé\\Documents\\DAM\\PROYECTO\\Proyecto\\iloveimg-resized\\admin.jpg")); // NOI18N
        iAdmin.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        iAdmin.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                iAdminMouseClicked(evt);
            }
        });

        menuIr.setText("Ir a...");

        mClientesMascotas.setText("Clientes/Mascotas");
        menuIr.add(mClientesMascotas);

        mCitas.setText("Citas");
        menuIr.add(mCitas);

        mFacturas.setText("Facturacion");
        menuIr.add(mFacturas);

        mAdmin.setText("Administracion");
        menuIr.add(mAdmin);

        jMenuBar1.add(menuIr);

        menuIdioma.setText("Idioma");

        grupoRadioIdioma.add(mCastellano);
        mCastellano.setSelected(true);
        mCastellano.setText("Castellano");
        mCastellano.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mCastellanoActionPerformed(evt);
            }
        });
        menuIdioma.add(mCastellano);

        grupoRadioIdioma.add(mGalego);
        mGalego.setText("Galego");
        mGalego.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mGalegoActionPerformed(evt);
            }
        });
        menuIdioma.add(mGalego);

        jMenuBar1.add(menuIdioma);

        setJMenuBar(jMenuBar1);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(iCitas, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(iMascotas, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(iFacturas, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(iAdmin, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(iMascotas, javax.swing.GroupLayout.PREFERRED_SIZE, 155, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(iFacturas, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 155, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(35, 35, 35)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(iCitas, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(iAdmin, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void iCitasMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_iCitasMouseClicked
        // TODO add your handling code here:
        if (iCitas.isEnabled()) System.out.println("CITAS");
    }//GEN-LAST:event_iCitasMouseClicked

    private void iAdminMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_iAdminMouseClicked
        // TODO add your handling code here:
        if (iAdmin.isEnabled()) System.out.println("ADMIN");
    }//GEN-LAST:event_iAdminMouseClicked

    private void iFacturasMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_iFacturasMouseClicked
        // TODO add your handling code here:
        if (iFacturas.isEnabled()) System.out.println("FACTU");
    }//GEN-LAST:event_iFacturasMouseClicked

    private void iMascotasMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_iMascotasMouseClicked
        
        if (iMascotas.isEnabled()) {
            
            new VistaClienteMascota(this, usuario).setVisible(true);
            this.setVisible(false);
        }
    }//GEN-LAST:event_iMascotasMouseClicked

    private void mCastellanoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mCastellanoActionPerformed
        usuario.setIdioma("es-ES");
        cargarTextos("es-ES");
    }//GEN-LAST:event_mCastellanoActionPerformed

    private void mGalegoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mGalegoActionPerformed
        cargarTextos("gl-ES");
        usuario.setIdioma("gl-ES");
    }//GEN-LAST:event_mGalegoActionPerformed

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        try {    //Windows closed no funcionaria
            new UsuarioDAO().modificar(usuario);
        } catch (IOException ex) {
            Idioma i = new Idioma(usuario.getIdioma());
            JOptionPane.showMessageDialog(this,i.texto("error.conexion.mensaje"),i.texto("error.conexion.titulo"), 
                    JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_formWindowClosing



    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup grupoRadioIdioma;
    private javax.swing.JLabel iAdmin;
    private javax.swing.JLabel iCitas;
    private javax.swing.JLabel iFacturas;
    private javax.swing.JLabel iMascotas;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenuItem mAdmin;
    private javax.swing.JRadioButtonMenuItem mCastellano;
    private javax.swing.JMenuItem mCitas;
    private javax.swing.JMenuItem mClientesMascotas;
    private javax.swing.JMenuItem mFacturas;
    private javax.swing.JRadioButtonMenuItem mGalego;
    private javax.swing.JMenu menuIdioma;
    private javax.swing.JMenu menuIr;
    // End of variables declaration//GEN-END:variables

    private void cargarTextos(String idioma) {
        Idioma i = new Idioma(idioma);
        
        menuIr.setText(i.texto("menu.ir"));
        mClientesMascotas.setText(i.texto("menu.ir.clientes_mascotas"));
        mCitas.setText(i.texto("menu.ir.citas"));
        mFacturas.setText(i.texto("menu.ir.facturas"));
        mAdmin.setText(i.texto("menu.ir.admin"));
        menuIdioma.setText(i.texto("menu.idioma"));
        mCastellano.setText(i.texto("menu.idioma.castellano"));
        mGalego.setText(i.texto("menu.idioma.gallego"));
        iMascotas.setToolTipText(i.texto("principal.imascotas.tip"));
        iCitas.setToolTipText(i.texto("principal.icitas.tip"));
        iFacturas.setToolTipText(i.texto("principal.ifacturas.tip"));
        iAdmin.setToolTipText(i.texto("principal.iadmin.tip"));
        
    }
}
